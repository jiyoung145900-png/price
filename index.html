<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DAISY HOOKUPS | ì½”ìŠ¤ ë° ê°€ê²©í‘œ (ê´€ë¦¬ì í¸ì§‘ ê°€ëŠ¥ - ìµœì¢…)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* --- 1. ê¸°ë³¸ ì„¤ì • ë° í¬ê¸° ì§€ì • --- */
        body { 
            font-family: 'Malgun Gothic', 'Arial', sans-serif; 
            margin: 0; 
            padding: 0; 
            display: flex; 
            justify-content: center; 
            background-color: #f0f2f5; 
            position: relative; 
        }
        
        .phone-container {
            position: relative; 
            display: flex;
            justify-content: center;
        }
        .phone-frame {
            width: 680px; 
            height: 1248px; 
            overflow-y: auto; 
            background-color: #fff;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
            border-radius: 20px;
            padding: 30px 25px; 
            box-sizing: border-box;
            position: relative;
        }

        /* â˜…â˜…â˜… ë°°ê²½ ì´ë¯¸ì§€ ì‚½ì… ê³µê°„ â˜…â˜…â˜… */
        #main-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0; 
            opacity: 0.8; 
            background-image: url('bok.png'); 
            background-size: cover; 
            background-position: center; 
        }
        
        #course-list-view, #detail-view, #admin-view {
            position: relative;
            z-index: 1; 
        }

        /* --- 2. ì œì–´ ë²„íŠ¼ ê·¸ë£¹ ìŠ¤íƒ€ì¼ (í”„ë ˆì„ ë°”ê¹¥ ìš°ì¸¡ ìƒë‹¨ ë¶„ë¦¬) --- */
        #control-buttons {
            position: absolute; 
            top: 30px; 
            right: -170px; 
            z-index: 1001; 
            display: flex;
            flex-direction: column; 
            gap: 10px; 
            width: 150px; 
        }

        /* ê°œë³„ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #control-buttons button {
            padding: 10px 10px; 
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95em;
            width: 100%; 
            font-weight: bold;
            box-shadow: 0 4px 0 rgba(0,0,0,0.3);
            transition: background-color 0.2s;
        }

        /* ë²„íŠ¼ë³„ ìƒ‰ìƒ ì„¤ì • */
        #toggle-admin-btn { background-color: #5B5BFF; color: white; }
        #save-admin-changes-btn {
            background-color: #4CAF50; /* ë…¹ìƒ‰ */
            color: white;
            display: none; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
        }
        /* ìº¡ì²˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #capture-list-btn, #capture-quote-btn { background-color: #ff69b4; color: white; }
        
        #show-quote-btn { background-color: #9c27b0; color: white; }
        #save-options-btn { background-color: #00bcd4; color: white; }
        

        /* í¸ì§‘ ëª¨ë“œì¼ ë•Œì˜ ë²„íŠ¼ ìƒ‰ìƒ */
        .admin-mode-active {
            background-color: #FF0000 !important;
            box-shadow: 0 4px 0 #b30000 !important;
        }
        /* ìƒì„¸ í˜ì´ì§€ì—ì„œë§Œ ë³´ì—¬ì•¼ í•˜ëŠ” ë²„íŠ¼ */
        .detail-only {
            display: none; 
        }
        
        /* --- 3. ì½”ìŠ¤ ëª©ë¡ ë° ê´€ë¦¬ì ìŠ¤íƒ€ì¼ --- */
        #admin-view { 
            display: none; 
            background-color: #ffe0f7; 
            padding: 20px; 
            border-radius: 15px; 
            margin-top: 20px; 
            border: 2px dashed #d11e8a; 
        }
        .admin-course-item { 
            background-color: #fff; 
            padding: 15px; 
            margin-bottom: 15px; 
            border-radius: 8px; 
            border: 1px solid #ffb6c1; 
        }
        .admin-course-item input, .admin-course-item button, .admin-option-item input { 
            width: calc(100% - 10px); 
            padding: 8px; 
            margin-top: 5px; 
            margin-bottom: 5px; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            box-sizing: border-box; 
        }
        .admin-course-item .price-input { 
            width: calc(50% - 15px); 
            float: right; 
            margin-left: 10px; 
        }
        .admin-course-item .name-input { 
            width: calc(50% - 15px); 
        }
        .admin-option-item { 
            display: flex; 
            gap: 10px; 
            margin-bottom: 5px; 
            align-items: center; 
        }
        .admin-option-item input[data-opt-field="name"] { 
            width: 40%; 
            margin: 0; 
        }
        .admin-option-item input[data-opt-field="price"] {
            width: 35%; 
            margin: 0;
        }
        .admin-option-item button { 
            width: 20%; 
            padding: 8px 5px; 
            margin: 0; 
            font-size: 0.8em; 
        }
        .admin-button-group button { width: 100%; margin-top: 10px; }
        
        .course-list-header { color: #d11e8a; text-align: center; font-size: 1.5em; margin-top: 150px; margin-bottom: 30px; }
        .course-item { background-color: rgba(255, 240, 245, 0.95); border: 2px solid #ffb6c1; padding: 20px; margin-bottom: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: background-color 0.2s, transform 0.2s; }
        .course-item .course-title { font-size: 1.3em; font-weight: bold; color: #d11e8a; }
        .course-item .course-price { font-size: 1.2em; font-weight: 900; color: #5B5BFF; margin-left: 15px; }
        
        /* --- 4. ìƒì„¸ ë·° ë° ì˜µì…˜ ìŠ¤íƒ€ì¼ (ìƒëµ) --- */
        #detail-view { display: none; flex-direction: column; background-color: rgba(245, 248, 255, 0.95); padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        #detail-view h3 { color: #d11e8a; font-size: 1.6em; margin-bottom: 10px; }
        #detail-view p { font-size: 1.1em; color: #333; border-bottom: 1px dashed #ccc; padding-bottom: 15px; margin-bottom: 20px; }
        #options-list h3 { color: #5B5BFF; font-size: 1.3em; margin-top: 20px; margin-bottom: 15px; border-left: 5px solid #ff69b4; padding-left: 10px; }
        .option-item input[type="checkbox"] { transform: scale(1.3); margin-right: 15px; accent-color: #ff69b4; }
        #total-display { background-color: #f7f7f7; padding: 15px 20px; margin-top: 20px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #ddd; }
        #current-total-price { font-size: 1.8em; font-weight: 900; color: #ff0000; }
        .action-btn { width: 100%; padding: 15px; margin-top: 25px; border-radius: 10px; font-size: 1.2em; cursor: pointer; border: none; transition: background-color 0.2s; font-weight: bold; }
        #back-btn { background-color: #ccc; color: #333; box-shadow: 0 4px 0 #999; }

        /* --- 5. ìµœì¢… ê²¬ì  ëª¨ë‹¬ --- */
        .modal-overlay { 
            display: none; 
            position: fixed; 
            top: 0; left: 0; width: 100%; height: 100%; 
            background-color: rgba(0, 0, 0, 0.7); 
            z-index: 1000; 
            justify-content: center; align-items: center; 
        }
        .modal-content { 
            background-color: white; 
            padding: 30px; 
            border-radius: 12px; 
            width: 90%; 
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 3px solid #ff69b4; 
            box-sizing: border-box; 
        }
        .quote-header { text-align: center; border-bottom: 3px solid #d11e8a; padding-bottom: 15px; margin-bottom: 20px; }
        .quote-header h3 { color: #d11e8a; font-size: 1.8em;}
        .quote-options { padding: 10px 0; border-top: 1px dashed #ffb6c1; border-bottom: 1px dashed #ffb6c1; margin-bottom: 20px; }
        .quote-options h4 { color: #5B5BFF; font-weight: bold; margin-top: 5px; margin-bottom: 8px; }
        .quote-options ul { list-style: none; padding-left: 0; }
        .quote-options li { list-style-type: none; position: relative; padding-left: 20px; }
        .quote-options li::before { content: "ğŸŒ¸"; position: absolute; left: 0; font-size: 0.8em; }
        .final-total { text-align: center; margin-top: 30px; padding-top: 15px; border-top: 2px solid #d11e8a; }
        .final-total .total-price { font-size: 3.5em; font-weight: 900; color: #ff0000; }

        /* ëª¨ë‹¬ ë‚´ë¶€ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .modal-button { width: 100%; margin-top: 10px; padding: 12px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: background-color 0.2s; }
        #modal-close-btn { background-color: #ccc; color: #333; margin-top: 15px; box-shadow: 0 4px 0 #999; }
    </style>
</head>
<body>

<div class="phone-container">
    
    <div class="phone-frame" id="phone-frame-capture">
        
        <div id="main-background"></div>
        
        <div id="course-list-view">
            <h3 class="course-list-header">ğŸ’ ì½”ìŠ¤ ëª©ë¡ ë° ê°€ê²© ğŸ’</h3>
            
            <div id="course-items-container">
            </div>
        </div>

        <div id="admin-view">
            <h3>ğŸ”‘ ì½”ìŠ¤ ë° ì˜µì…˜ í¸ì§‘ ëª¨ë“œ</h3>
            <div id="admin-course-editor">
                </div>
            <button class="admin-button-group" style="background-color:#5B5BFF; color:white;" onclick="addNewCourse(event)">â• ìƒˆ ì½”ìŠ¤ ì¶”ê°€</button>
        </div>


        <div id="detail-view">
            <h3 id="detail-title-selected" style="color: #d11e8a; text-align: center;"></h3>
            <p style="text-align: center;">[<span id="detail-time-selected"></span> | ê¸°ë³¸ ê¸ˆì•¡: â‚© <span id="detail-price-selected-val">0</span>]</p>

            <div id="options-list">
                <h3>ì„ íƒ ì˜µì…˜ ì¶”ê°€ (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</h3>
            </div>
            
            <div id="total-display">
                <strong>í˜„ì¬ê¹Œì§€ì˜ ì´ í•©ê³„ ê¸ˆì•¡</strong>
                <span id="current-total-price">â‚© 0</span>
            </div>

            <button id="back-btn" class="action-btn" onclick="showCourseList()">â† ì½”ìŠ¤ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
    </div>
    
    <div id="control-buttons">
        <button id="toggle-admin-btn" onclick="toggleAdminMode()">âš™ï¸ í¸ì§‘ ëª¨ë“œ</button>
        <button id="save-admin-changes-btn" onclick="saveAdminChanges()">âœ… í¸ì§‘ ë‚´ìš© ì €ì¥</button>
        
        <button id="capture-list-btn" onclick="captureFrameAsPNG('phone-frame-capture')">ğŸ“¸ ëª©ë¡ ìº¡ì²˜</button>
        
        <button id="show-quote-btn" class="detail-only" onclick="showFinalQuote()">ğŸ’¸ ê²¬ì ì„œ ë³´ê¸°</button>
        <button id="capture-quote-btn" class="detail-only" onclick="captureQuoteAsPNG()">ğŸ“· ê²¬ì ì„œ ìº¡ì²˜</button>
        <button id="save-options-btn" class="detail-only" onclick="saveUserSelectionsManually()">ğŸ’¾ í˜„ì¬ ì˜µì…˜ ì €ì¥</button>
    </div>
</div>

<div id="final-quote-modal" class="modal-overlay">
    <div class="modal-content" id="modal-capture-target">
        <div class="quote-header">
            <h3>DAISY ìµœì¢… ê²¬ì ì„œ</h3>
        </div>
        
        <div id="quote-details-content">
            </div>
        
        <div class="final-total">
            <p>ì´ í•©ê³„ ê¸ˆì•¡</p>
            <div class="total-price">â‚© <span id="modal-total-price">0</span></div>
        </div>
        
        <button id="modal-close-btn" class="modal-button" onclick="closeFinalQuoteModal()">ë‹«ê¸°</button>
    </div>
</div>

<script>
    // ìµœì´ˆ ê¸°ë³¸ ë°ì´í„° 
    const INITIAL_COURSES = {
        'sapphire': { title: 'ì‚¬íŒŒì´ì–´', time: '1ì‹œê°„', basePrice: 50000, options: [{name: 'ê¸°ë³¸ ë§ˆì‚¬ì§€', price: 0}, {name: 'í•¸ë“œì¡', price: 15000}, {name: 'ì…ì‹¸/ì–¼ì‹¸', price: 5000}, {name: 'ë‹ˆí”Œ í”Œë ˆì´', price: 10000}] },
        'emerald': { title: 'ì—ë©”ë„ë“œ', time: '2ì‹œê°„', basePrice: 90000, options: [{name: 'ê¸°ë³¸ ë§ˆì‚¬ì§€', price: 0}, {name: 'íŒŒì´ì¦ˆë¦¬', price: 20000}, {name: 'ì „ì‹  ë°”ë”” íƒ€ê¸°', price: 20000}, {name: 'ë¬´í•œ ì˜¤ë„ (BJ)', price: 30000}] },
        'ruby': { title: 'ë£¨ë¹„', time: '4ì‹œê°„', basePrice: 180000, options: [{name: 'ê¸°ë³¸ ë§ˆì‚¬ì§€', price: 0}, {name: 'ì§ˆë‚´ ì‚¬ì • (ì§ˆì‹¸)', price: 30000}, {name: 'ë…¸ì½˜ ì˜µì…˜', price: 20000}, {name: 'ì• ë„ (ë’¤íƒœ ê³µëµ)', price: 50000}, {name: 'ì¤‘ì¶œ (ì‚¬ì • í›„ ì…ë§ì¶¤)', price: 20000}] },
        'diamond': { title: 'ë‹¤ì´ì•„ëª¬ë“œ', time: '12ì‹œê°„', basePrice: 500000, options: [{name: 'ê¸°ë³¸ ë§ˆì‚¬ì§€ì§€', price: 0}, {name: 'ì½”ìŠ¤íŠ¬ (êµë³µ/ê°„í˜¸ì‚¬/ê²½ì°°)', price: 10000}, {name: 'ìˆ˜ì¹˜í”Œ / ë˜¥ê¹Œì‹œ', price: 30000}, {name: 'ì•ˆëŒ€ & ê°œê°ˆê¸° ì‚¬ìš©', price: 20000}] },
        'topaz': { title: 'í† íŒŒì¦ˆ', time: '24ì‹œê°„', basePrice: 1000000, options: [{name: 'ê¸°ë³¸ ë§ˆì‚¬ì§€', price: 0}, {name: 'ë³¸ë””ì§€ (ê²°ë°• í”Œë ˆì´)', price: 40000}, {name: 'SM í”Œë ˆì´ / ê°•ê°„í”Œ', price: 70000}, {name: 'ë…¸ì˜ˆ í”Œë ˆì´ (1:1 ë§ì¶¤ í•˜ë“œ)', price: 70000}] },
    };
    
    let coursesData; 
    let currentSelectedCourseKey = null;
    let isEditingMode = false;
    let newCourseIndex = 0; 
    const frame = document.getElementById('phone-frame-capture');

    const formatPrice = (price) => price.toLocaleString('ko-KR');

    // --- ì €ì¥/ë¡œë“œ ë¡œì§ ---

    function loadCoursesData() {
        const savedData = localStorage.getItem('daisyCoursesData');
        const savedIndex = localStorage.getItem('daisyNewCourseIndex'); 

        if (savedData) {
            try {
                coursesData = JSON.parse(savedData);
                if (!coursesData || Object.keys(coursesData).length === 0) throw new Error("Empty data");
            } catch (e) {
                coursesData = INITIAL_COURSES;
            }
        } else {
            coursesData = INITIAL_COURSES;
        }

        if (savedIndex) {
            newCourseIndex = parseInt(savedIndex) || 0; 
        } else {
            newCourseIndex = 0;
        }
    }
    
    function saveCoursesData() {
        localStorage.setItem('daisyCoursesData', JSON.stringify(coursesData));
        localStorage.setItem('daisyNewCourseIndex', newCourseIndex); 
    }

    /**
     * [ìë™ ì €ì¥] í˜„ì¬ ì½”ìŠ¤ì˜ ì˜µì…˜ ì„ íƒ ìƒíƒœë¥¼ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•©ë‹ˆë‹¤.
     */
    function saveUserSelection() {
        if (!currentSelectedCourseKey) return;

        const savedSelectionsRaw = localStorage.getItem('daisyUserSelections');
        let savedSelections = {};
        try {
            savedSelections = savedSelectionsRaw ? JSON.parse(savedSelectionsRaw) : {};
        } catch (e) {
            console.error("Failed to parse user selections, resetting.", e);
        }
        
        const selectedOptions = [];
        document.querySelectorAll('#options-list input[type="checkbox"]').forEach((checkbox, index) => {
            if (checkbox.checked) {
                selectedOptions.push(index);
            }
        });

        savedSelections[currentSelectedCourseKey] = {
            selectedOptions: selectedOptions
        };

        localStorage.setItem('daisyUserSelections', JSON.stringify(savedSelections));
        console.log(`âœ… [${coursesData[currentSelectedCourseKey]?.title}] ì˜µì…˜ ìƒíƒœ ìë™ ì €ì¥ë¨.`);
    }
    
    /**
     * [ìˆ˜ë™ ì €ì¥] ìˆ˜ë™ ì €ì¥ ë²„íŠ¼ì„ ìœ„í•œ í•¨ìˆ˜.
     */
    function saveUserSelectionsManually() {
        if (!currentSelectedCourseKey) {
            alert("ì„ íƒëœ ì½”ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }
        saveUserSelection(); 
        alert(`âœ… [${coursesData[currentSelectedCourseKey].title} ì½”ìŠ¤] ì˜µì…˜ ì„¤ì •ì´ ìˆ˜ë™ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }

    // --- ë·° ì „í™˜ ë° ë Œë”ë§ ---
    function renderCourseList() {
        document.getElementById('course-list-view').style.display = 'block';
        document.getElementById('detail-view').style.display = 'none';
        document.getElementById('admin-view').style.display = 'none'; 
        
        document.getElementById('toggle-admin-btn').textContent = 'âš™ï¸ í¸ì§‘ ëª¨ë“œ';
        document.getElementById('toggle-admin-btn').classList.remove('admin-mode-active');
        document.getElementById('capture-list-btn').style.display = 'block'; 
        
        document.getElementById('save-admin-changes-btn').style.display = 'none';

        // ìƒì„¸ í˜ì´ì§€ ì „ìš© ë²„íŠ¼ ìˆ¨ê¹€
        document.getElementById('show-quote-btn').classList.add('detail-only');
        document.getElementById('capture-quote-btn').classList.add('detail-only');
        document.getElementById('save-options-btn').classList.add('detail-only');


        const itemsContainer = document.getElementById('course-items-container');
        let html = '';
        for (const key in coursesData) {
            const course = coursesData[key];
            html += `
                <div class="course-item" data-key="${key}" onclick="selectCourse('${key}')">
                    <div class="course-title">${course.title} ì½”ìŠ¤</div>
                    <div class="course-info">
                        <span>${course.time}</span>
                        <span class="course-price">â‚© ${formatPrice(course.basePrice)}</span>
                    </div>
                </div>
            `;
        }
        itemsContainer.innerHTML = html;
        
        document.getElementById('phone-frame-capture').scrollTop = 0;
    }
    
    function showCourseList() {
        isEditingMode = false;
        renderCourseList();
        document.getElementById('detail-view').style.display = 'none';
        closeFinalQuoteModal();
    }


    // --- ê´€ë¦¬ì í¸ì§‘ ëª¨ë“œ í•¨ìˆ˜ ---
    function toggleAdminMode() {
        isEditingMode = !isEditingMode;
        
        if (isEditingMode) {
            document.getElementById('course-list-view').style.display = 'none';
            document.getElementById('detail-view').style.display = 'none';
            document.getElementById('admin-view').style.display = 'block';
            
            document.getElementById('toggle-admin-btn').textContent = 'âŒ í¸ì§‘ ì¢…ë£Œ (ë¯¸ì €ì¥)';
            document.getElementById('toggle-admin-btn').classList.add('admin-mode-active');
            document.getElementById('save-admin-changes-btn').style.display = 'block'; 

            document.getElementById('capture-list-btn').style.display = 'none'; 
            
            document.getElementById('show-quote-btn').classList.add('detail-only');
            document.getElementById('capture-quote-btn').classList.add('detail-only');
            document.getElementById('save-options-btn').classList.add('detail-only');

            renderAdminEditor();
        } else {
            if(confirm("í¸ì§‘ ëª¨ë“œë¥¼ ì €ì¥í•˜ì§€ ì•Šê³  ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì €ì¥í•˜ë ¤ë©´ 'ì·¨ì†Œ'ë¥¼ ëˆ„ë¥´ê³  'í¸ì§‘ ë‚´ìš© ì €ì¥'ì„ ëˆ„ë¥´ì„¸ìš”)")) {
                loadCoursesData(); 
                renderCourseList();
            } else {
                isEditingMode = true; 
            }
        }
    }

    function deleteOptionFromCourse(courseKey, index) {
        if (coursesData[courseKey].options.length === 1) {
            alert("ìµœì†Œí•œ í•˜ë‚˜ì˜ ì˜µì…˜ì€ ë‚¨ê²¨ì•¼ í•©ë‹ˆë‹¤.");
            return;
        }
        // í˜„ì¬ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì €ì¥
        const scrollPosition = document.getElementById('phone-frame-capture').scrollTop;
        
        coursesData[courseKey].options.splice(index, 1);
        
        renderAdminEditor();
        
        // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ë³µì›
        document.getElementById('phone-frame-capture').scrollTop = scrollPosition;
    }
    
    function addOptionToCourse(event, courseKey) {
        if (event) event.preventDefault(); 

        if (!coursesData[courseKey].options) {
            coursesData[courseKey].options = [];
        }
        coursesData[courseKey].options.push({name: 'ìƒˆ ì˜µì…˜', price: 0}); 
        
        renderAdminEditor(); 

        // ìƒˆë¡œ ì¶”ê°€ëœ ì½”ìŠ¤ì˜ ë§ˆì§€ë§‰ ì˜µì…˜ ìœ„ì¹˜ë¡œ ìŠ¤í¬ë¡¤
        const courseElement = document.querySelector(`.admin-course-item[data-key="${courseKey}"]`);
        if (courseElement) {
            const optionsContainer = courseElement.querySelector('.admin-options-container');
            if (optionsContainer.lastElementChild) {
                optionsContainer.lastElementChild.scrollIntoView({ behavior: 'smooth', block: 'end' });
            }
        }
    }


    function renderAdminEditor() {
        const editorContainer = document.getElementById('admin-course-editor');
        let html = '';
        
        for (const key in coursesData) {
            const course = coursesData[key];
            
            html += `
                <div class="admin-course-item" data-key="${key}">
                    <h4>${course.title} ì½”ìŠ¤ (${key})</h4>
                    <label>ì½”ìŠ¤ ì´ë¦„:</label>
                    <input type="text" data-field="title" value="${course.title}">
                    
                    <label>ì‹œê°„:</label>
                    <input type="text" data-field="time" value="${course.time}">
                    
                    <label>ê¸°ë³¸ ê¸ˆì•¡:</label>
                    <input type="number" data-field="basePrice" value="${course.basePrice}" class="price-input">
                    <hr style="border-top:1px dashed #eee; margin:10px 0;">

                    <h5>ì„¸ë¶€ ì˜µì…˜</h5>
                    <div class="admin-options-container" id="options-${key}">
            `;
            
            course.options.forEach((opt, index) => {
                html += renderAdminOptionItem(key, index, opt.name, opt.price);
            });
            
            html += `
                    </div>
                    <button style="background-color:#4CAF50; color:white; width:100%;" onclick="addOptionToCourse(event, '${key}')">â• ì˜µì…˜ ì¶”ê°€</button>
                    <button style="background-color:#F44336; color:white; margin-top:10px;" onclick="deleteCourse(event, '${key}')">âŒ ì½”ìŠ¤ ì‚­ì œ</button>
                </div>
            `;
        }
        editorContainer.innerHTML = html;
    }

    function renderAdminOptionItem(courseKey, index, name, price) {
        return `
            <div class="admin-option-item" data-index="${index}">
                <input type="text" value="${name}" data-opt-field="name" placeholder="ì˜µì…˜ ì´ë¦„">
                <input type="number" value="${price}" data-opt-field="price" placeholder="ê°€ê²©" class="price-input">
                <button style="background-color:#F44336; color:white;" onclick="deleteOptionFromCourse('${courseKey}', ${index})">ì‚­ì œ</button>
            </div>
        `;
    }

    function addNewCourse(event) {
        if (event) event.preventDefault(); 
        
        const keyPrefix = 'custom';
        let newKey = keyPrefix + newCourseIndex;
        while(coursesData.hasOwnProperty(newKey)) {
            newCourseIndex++;
            newKey = keyPrefix + newCourseIndex;
        }
        
        coursesData[newKey] = {
            title: 'ìƒˆë¡œìš´ ì½”ìŠ¤', 
            time: '0ì‹œê°„', 
            basePrice: 0, 
            options: [{name: 'ê¸°ë³¸ ì˜µì…˜', price: 0}]
        };
        newCourseIndex++; 
        
        renderAdminEditor();
        
        const newCourseElement = document.querySelector(`.admin-course-item[data-key="${newKey}"]`);
        if (newCourseElement) {
            newCourseElement.scrollIntoView({ behavior: 'smooth', block: 'end' });
        }
    }
    
    function deleteCourse(event, courseKey) {
        if (event) event.preventDefault(); 

        if (Object.keys(coursesData).length === 1) {
            alert("ìµœì†Œí•œ í•˜ë‚˜ì˜ ì½”ìŠ¤ëŠ” ë‚¨ê²¨ì•¼ í•©ë‹ˆë‹¤.");
            return;
        }
        
        const scrollPosition = document.getElementById('phone-frame-capture').scrollTop;

        if (confirm(`ì •ë§ë¡œ ì½”ìŠ¤ [${coursesData[courseKey].title}]ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            delete coursesData[courseKey];
            renderAdminEditor();
            
            document.getElementById('phone-frame-capture').scrollTop = scrollPosition;
        }
    }

    function saveAdminChanges() {
        const editorItems = document.querySelectorAll('#admin-course-editor .admin-course-item');
        const newCoursesData = {};
        
        let maxNewIndex = 0;

        editorItems.forEach(item => {
            const oldKey = item.dataset.key;
            
            if (oldKey.startsWith('custom')) {
                const index = parseInt(oldKey.replace('custom', ''));
                if (!isNaN(index) && index >= maxNewIndex) {
                    maxNewIndex = index + 1;
                }
            }

            const title = item.querySelector('input[data-field="title"]').value;
            const time = item.querySelector('input[data-field="time"]').value;
            const basePriceInput = item.querySelector('input[data-field="basePrice"]');
            const basePrice = parseInt(basePriceInput.value) || 0;
            
            const newOptions = [];
            item.querySelectorAll('.admin-option-item').forEach(optionItem => {
                const name = optionItem.querySelector('input[data-opt-field="name"]').value;
                const priceInput = optionItem.querySelector('input[data-opt-field="price"]');
                const price = parseInt(priceInput.value) || 0;
                newOptions.push({name: name, price: price});
            });

            newCoursesData[oldKey] = {
                title: title,
                time: time,
                basePrice: basePrice,
                options: newOptions
            };
        });

        coursesData = newCoursesData;
        newCourseIndex = maxNewIndex; 

        saveCoursesData(); 
        alert("âœ… ì½”ìŠ¤ ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
        
        isEditingMode = false;
        renderCourseList();
    }

    // --- ì‚¬ìš©ì ìƒí˜¸ì‘ìš© í•¨ìˆ˜ ---
    function selectCourse(key) {
        currentSelectedCourseKey = key;
        const course = coursesData[key];
        
        document.getElementById('course-list-view').style.display = 'none';
        document.getElementById('admin-view').style.display = 'none';
        document.getElementById('detail-view').style.display = 'flex';
        
        document.getElementById('detail-title-selected').textContent = course.title + ' ì½”ìŠ¤';
        document.getElementById('detail-time-selected').textContent = course.time;
        document.getElementById('detail-price-selected-val').textContent = formatPrice(course.basePrice);
        
        document.getElementById('show-quote-btn').classList.remove('detail-only');
        document.getElementById('capture-quote-btn').classList.remove('detail-only');
        document.getElementById('save-options-btn').classList.remove('detail-only');
        
        document.getElementById('save-admin-changes-btn').style.display = 'none';
        
        renderOptions(course.options);
        
        document.getElementById('phone-frame-capture').scrollTop = 0;
    }

    function renderOptions(options) {
        const optionsList = document.getElementById('options-list');
        let html = '<h3>ì„ íƒ ì˜µì…˜ ì¶”ê°€ (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</h3>';
        
        options.forEach((opt, index) => {
            html += `
                <div class="option-item">
                    <input type="checkbox" id="opt-${index}" data-price="${opt.price}" onchange="updateTotalPrice()"> 
                    <label for="opt-${index}">
                        ${opt.name} (<span style="color:red;">+${formatPrice(opt.price)}ì›</span>)
                    </label>
                </div>
            `;
        });
        optionsList.innerHTML = html;
        
        const savedSelectionsRaw = localStorage.getItem('daisyUserSelections');
        let savedSelections = {};
        try {
             savedSelections = savedSelectionsRaw ? JSON.parse(savedSelectionsRaw) : {};
        } catch (e) {
             console.error("Failed to parse user selections on render.", e);
        }
        
        const currentCourseSaved = savedSelections[currentSelectedCourseKey];
        let optionsToPreCheck = currentCourseSaved && Array.isArray(currentCourseSaved.selectedOptions) ? currentCourseSaved.selectedOptions : [];
        
        document.querySelectorAll('#options-list input[type="checkbox"]').forEach((cb, index) => {
            if (optionsToPreCheck.includes(index)) {
                cb.checked = true;
            } else {
                cb.checked = false;
            }
        });
        
        updateTotalPrice(false); 
    }

    /**
     * ì´ ê¸ˆì•¡ ì—…ë°ì´íŠ¸. ì˜µì…˜ ë³€ê²½ ì‹œ ìë™ ì €ì¥í•©ë‹ˆë‹¤.
     */
    function updateTotalPrice(shouldSave = true) {
        if (!currentSelectedCourseKey) return;

        const course = coursesData[currentSelectedCourseKey];
        let totalPrice = course.basePrice;

        document.querySelectorAll('#options-list input[type="checkbox"]:checked').forEach(checkbox => {
            const price = parseInt(checkbox.dataset.price);
            totalPrice += price;
        });

        document.getElementById('current-total-price').textContent = 'â‚© ' + formatPrice(totalPrice);
        
        if (shouldSave) {
            saveUserSelection(); 
        }
    }

    function showFinalQuote() {
        if (!currentSelectedCourseKey) {
            alert("ê²¬ì ì„œë¥¼ ë³´ë ¤ë©´ ì½”ìŠ¤ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.");
            return;
        }
        
        const course = coursesData[currentSelectedCourseKey];
        let totalPrice = course.basePrice;
        let selectedOptionsHtml = '';

        document.querySelectorAll('#options-list input[type="checkbox"]:checked').forEach(checkbox => {
            const price = parseInt(checkbox.dataset.price);
            totalPrice += price;
            const optionLabel = checkbox.nextElementSibling.textContent.trim();
            const optionName = optionLabel.substring(0, optionLabel.lastIndexOf('(')).trim();

            selectedOptionsHtml += `<li>â€¢ ${optionName} (â‚© ${formatPrice(price)})</li>`;
        });

        const detailContent = `
            <div class="quote-details">
                <p><strong>ì„ íƒ ì½”ìŠ¤:</strong> ${course.title} ì½”ìŠ¤</p>
                <p><strong>ì§„í–‰ ì‹œê°„:</strong> ${course.time}</p>
                <p><strong>ê¸°ë³¸ ê¸ˆì•¡:</strong> â‚© ${formatPrice(course.basePrice)}</p>
            </div>
            <div class="quote-options">
                <h4>ì¶”ê°€ ì„ íƒ ì˜µì…˜</h4>
                <ul>
                    ${selectedOptionsHtml || '<li>ì„ íƒëœ ì˜µì…˜ ì—†ìŒ</li>'}
                </ul>
            </div>
        `;

        document.getElementById('quote-details-content').innerHTML = detailContent;
        document.getElementById('modal-total-price').textContent = formatPrice(totalPrice);
        document.getElementById('final-quote-modal').style.display = 'flex';
    }

    function closeFinalQuoteModal() {
        document.getElementById('final-quote-modal').style.display = 'none';
    }

    // --- ìº¡ì²˜ ê¸°ëŠ¥ í•¨ìˆ˜ 1: ëª©ë¡ ìº¡ì²˜ (ìƒˆ íƒ­ì—ì„œ ì´ë¯¸ì§€ ì—´ê¸°) ---
    function captureFrameAsPNG(captureElementOrId) {
        let captureElement;
        
        if (typeof captureElementOrId === 'string') {
            captureElement = document.getElementById(captureElementOrId);
        } else {
            return;
        }

        if (isEditingMode) {
            alert("í¸ì§‘ ëª¨ë“œì—ì„œëŠ” ìº¡ì²˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì¼ë°˜ ê°€ê²©í‘œ ë³´ê¸°ë¡œ ì „í™˜í•´ ì£¼ì„¸ìš”.");
            return;
        }
        
        html2canvas(captureElement, {
            scale: 2, 
            useCORS: true,
            ignoreElements: (node) => {
                // ì œì–´ ë²„íŠ¼ì€ ìº¡ì²˜ì—ì„œ ì œì™¸
                if (node.id === 'control-buttons') {
                    return true;
                }
                return false;
            },
            windowHeight: captureElement.scrollHeight,
            scrollY: -captureElement.scrollTop
        }).then(canvas => {
            const dataURL = canvas.toDataURL('image/png');
            // ìƒˆ íƒ­ì„ ì—´ì–´ ìº¡ì²˜ëœ ì´ë¯¸ì§€ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.
            const newWindow = window.open();
            newWindow.document.write('<img src="' + dataURL + '" alt="ìº¡ì²˜ëœ ì´ë¯¸ì§€" style="max-width: 100%; height: auto;">');
            newWindow.document.title = 'DAISY ëª©ë¡ ìº¡ì²˜';
            alert(`âœ… ëª©ë¡ ìº¡ì²˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆ íƒ­ì—ì„œ ì´ë¯¸ì§€ë¥¼ í™•ì¸í•˜ê³  ì €ì¥í•´ì£¼ì„¸ìš”.`);
        }).catch(err => {
            console.error("PNG ìº¡ì²˜ ì‹¤íŒ¨:", err);
            alert("âŒ PNG ìº¡ì²˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ì½˜ì†” ë¡œê·¸ í™•ì¸)");
        });
    }

    // --- ìº¡ì²˜ ê¸°ëŠ¥ í•¨ìˆ˜ 2: ê²¬ì ì„œ ìº¡ì²˜ (ìƒˆ íƒ­ì—ì„œ ì´ë¯¸ì§€ ì—´ê¸°) ---
    function captureQuoteAsPNG() {
        if (!currentSelectedCourseKey) {
            alert("ê²¬ì ì„œ ìº¡ì²˜ë¥¼ ìœ„í•´ ì½”ìŠ¤ë¥¼ ë¨¼ì € ì„ íƒí•´ ì£¼ì„¸ìš”.");
            return;
        }
        
        // ê²¬ì ì„œ ëª¨ë‹¬ì„ ë„ì›ë‹ˆë‹¤.
        showFinalQuote(); 
        
        const modalContent = document.getElementById('modal-capture-target');

        // ëª¨ë‹¬ ë‚´ë¶€ì˜ ë‹«ê¸° ë²„íŠ¼ì„ ìº¡ì²˜ì—ì„œ ì œì™¸í•˜ê¸° ìœ„í•´ ì„ì‹œë¡œ ìˆ¨ê¹€
        const modalButton = document.getElementById('modal-close-btn');
        modalButton.style.display = 'none';
        
        html2canvas(modalContent, {
            scale: 2, 
            useCORS: true,
            backgroundColor: '#ffffff'
        }).then(canvas => {
            // ìº¡ì²˜ í›„ ë‹¤ì‹œ ë²„íŠ¼ ë³´ì´ê¸°
            modalButton.style.display = 'block';
            
            const dataURL = canvas.toDataURL('image/png');
            // ìƒˆ íƒ­ì„ ì—´ì–´ ìº¡ì²˜ëœ ì´ë¯¸ì§€ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.
            const newWindow = window.open();
            newWindow.document.write('<img src="' + dataURL + '" alt="ìº¡ì²˜ëœ ê²¬ì ì„œ ì´ë¯¸ì§€" style="max-width: 100%; height: auto;">');
            newWindow.document.title = 'DAISY ê²¬ì ì„œ ìº¡ì²˜';
            alert(`âœ… ê²¬ì ì„œ ìº¡ì²˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆ íƒ­ì—ì„œ ì´ë¯¸ì§€ë¥¼ í™•ì¸í•˜ê³  ì €ì¥í•´ì£¼ì„¸ìš”.`);


        }).catch(err => {
            modalButton.style.display = 'block';
            console.error("ê²¬ì ì„œ PNG ìº¡ì²˜ ì‹¤íŒ¨:", err);
            alert("âŒ ê²¬ì ì„œ PNG ìº¡ì²˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ì½˜ì†” ë¡œê·¸ í™•ì¸)");
        });
    }


    // --- ì´ˆê¸°í™” ---
    window.onload = () => {
        loadCoursesData();
        renderCourseList();
        document.getElementById('final-quote-modal').style.display = 'none';
        
        const saveAdminBtn = document.getElementById('save-admin-changes-btn');
        if (saveAdminBtn) {
            saveAdminBtn.style.display = 'none'; 
        }
    };
</script>

</body>
</html>
